#!/usr/bin/env bash

function usage() {
  cat <<EOU
Shortcuts for restic backups

books     backup for ~/Dropbox/Books
apps      backup /Applications and /Library
pics      backup lightroom pictures and catalog
raw       just call restic with arguments

EOU
 exit
}

# no args default to usage
[[ -z ${1} ]] && usage

# Restic B2Cloud
export B2_ACCOUNT_ID=$(pass show b2cloud/application/restic/keyid)
export B2_ACCOUNT_KEY=$(pass show b2cloud/application/restic/key)
export RESTIC_PASSWORD_FILE=$(pass_to_file b2cloud/restic/password)
export RESTIC_REPOSITORY="b2:mv-backup:restic"

CMD="sudo -E restic "

case ${1} in
  books)
    ${CMD} backup ${HOME}/Dropbox/Books
  ;;
  apps)
    ${CMD} backup --one-file-system /Applications /Library
  ;;
  pics)
    ${CMD} backup ${HOME}/Pictures/LightroomMasters ${HOME}/Pictures/Lightroom
  ;;
  docs)
    ${CMD} backup ${HOME}/Dropbox/Documents
  ;;
  snap)
    ${CMD} snapshots
  ;;
  raw)
    shift
    ${CMD} ${*}
  ;;
  *)
    usage
  ;;
esac

